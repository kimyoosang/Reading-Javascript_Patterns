# Chapter5. 객체 생성 패턴

## **5.1 네임스페이스 패턴**

- 네임스페이스는 프로그램에서 필요로하는 전역 변수의 개수를 줄이는 동시에 과도한 접두어를 사용하지 않고도 이름이 겹치지 않게 해준다
- 수많은 함수, 객체, 변수들로부터 전역 유효범위를 어지럽히는 대신, 애플리케이션이나 라이브러리를 위한 전역 객체를 하나 만들고 모든 기능을 이 객체에 추가하면 된다

```javascript

//수정 전: 전역 변수 5개
//경고. 안티패턴이다

//생성자 함수 2개
function Parent() {}
function Childe() {}

//변수 1개
var some_var = 1;

//객체 2개
var moduel1 = {};
moduel1.data = {a:1,b:2}
vare module2 = {};

```

- 위와 같은 코드를 리팩터링하기 위해서는 먼저 애플리케이션 전용 전역 객체, 이를 테면 MYAPP을 생선한다음 모든 함수와 변수들을 이 전역 객체의 프로퍼티로 변경한다

```javascript
//수정 후: 전역 변수 1개

//전역 객체
var MYAPP = {};

//생성자
MYAPP.Parent = function () {};
MYAPP.Child = function () {};

//변수
MYAAPP.some_var = 1;

//객체 컨테이너
MYAPP.modules = {};

//객체들을 컨테이너 안에 추가한다

//객체 2개
MYAPP.modules.module1 = {};
MYAPP.modules.module1.data = { a: 1, b: 2 };
MYAPP.modules.module2 = {};
```

- 네임스페이스 패턴의 장점
  1. 코드에 네임스페이스를 지정해주며, 코드내의 이름 충돌 뿐 아니라 이 코드와 같은 페이지에 존재하는 자바스크립트 라이브러리나 위짓 등 서브 파티 코드와의 이름 충동도 방지해준다
  2. 다양한 작업에 응용할 수 있으며, 매우 권장하는 패턴이다
- 네임스페이스 패턴의 단점
  1. 모든 변수와 함수에 접두어를 붙여야 하기 때문에 전체적으로 코드량이 약간 더 많아지고 다운로드해야 하는 파일 크기도 늘어난다
  2. 전역 인스턴스가 단 하나뿐이기 때문에 코드의 어느 한 부분이 수정되어도 전역 인스턴스를 수정하게 된다. 즉 나머지 기능들도 갱신된 상태를 물려받는다
  3. 이름이 중첩되고 길어지므로 프로퍼티를 판별하기위한 검색 작업도 길고 느려진다

**범용 네임스페이스 함수**

- 프로그램의 복잡도가 증가하고 코드의 각 부분들이 별개의 파일로 분리되어 선택적으로 문서에 포함되게 되면, 어떤 코드가 특정 네임스페이스나 그 내부의 프로퍼티를 처음으로 정의한다고 가정하기가 어려워진다
- 때문에 네임스페이스를 생성하거나 프로퍼티를 추가하기 전에 먼저 이미 존재하는지 여부를 확인해야 한다

```javascript
//위험하다
var MYAPP = {};
//개선안
if (typeof MYAPP === "undefined") {
  var MYAPP = {};
}
//또는 더 짧게 쓸 수 있다
var MYAPP = MYAPP || {};
```

- 다음은 네임스페이스 함수를 구현한 예제다. 다음과 같은 방식은 해당 네임스페이스가 존재하면 덮어쓰지 않기 때문에 기존 코드를 망가뜨리지 않는다

```javascript
var MYAPP = MYAPP || {}; //존재여부 확인

MYAPP.namespace = function (ns_string) {
  var parts = ns_string.split(","),
    parent = MYAPP,
    i;

  //처음에 중복되는 전역 객체명은 제거한다
  if (parts[0] === "MYAPP") {
    parts = parts.slice(1);
  }
  for (i = 0; i < parts.length; i += 1) {
    if (typeof parent[parts[i]] === "undefined") {
      parent[parts[i]] = {};
    }
    parent = parent[parts[i]];
  }
  return parent;
};
```

## **의존 관계 선언**

- 자바스크립트 라이브러리들은 대개 네임스페이스를 지정하여 모듈화되어 있기 때문에, 필요한 모듈만 골라서 쓸 수 있다
- 이 때 함수나 모듈 내 최상단에, 의존 관계에 있는 모듈을 선언하는 것이 좋다. 즉 지역 변수를 만들어 원하는 모듈을 가리키도록 선언하는 것이다

```javascript
var myFunction = function () {
  //의존 관계에 있는 모듈들
  var event = YAHOO.util.Event,
    dom = YAHOO.util.Dom;

  //이제 event와 dom이라는 변수를 사용한다
};
```

- 이 패턴의 장점
  1. 의존 관계가 명시적으로 선언되어 있기 때문에 코드를 사용하는 사람이 페이지내에 반드시 포함시켜야 하는 스크립트 파일이 무엇인지를 알 수 있다
  2. 함수의 첫머리에 의존 관계가 선언되기 때문에 의존 관계를 찾아내고 이해하기가 쉽다
  3. dom과 같은 지역 변수를 YAHOO와 같은 전역 변수보다 언제나 더 빠르며 YAHOO.util.Dom처럼 전역 변수의 중첩 프로퍼티와 비교하면 더 말할 것도 없다. 의존 관계 선언 패턴을 잘 지키면 함수 안에서 전역 객체 판별을 단 한 번만 수행하고, 이 다음부터는 지역변수를 사용하기 때문에 훨씬 빠르다
  4. YUI 컴프레서나 구글 클로서 등 고급 압축 도구는 지역 변수명에 대해서는 event를 A라는 글자 하나로 바꾸는 식으로 축약해 코드를 줄여준다. 하지만 전역 변수명 변경은 위험하기 때문에 축약하지 않는다
